name: ğŸ” PR Quality Checks

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  code-quality:
    name: ğŸ§¹ Code Quality
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” HTML Validation
      uses: Cyb3r-Jak3/html5validator-action@v7.2.0
      with:
        root: ./
        
    - name: ğŸ¨ CSS Lint
      run: |
        npm install -g stylelint stylelint-config-standard
        echo '{"extends": "stylelint-config-standard"}' > .stylelintrc.json
        stylelint "*.css" || true
        
    - name: ğŸ“ JavaScript Lint
      run: |
        npm install -g eslint
        echo '{"env": {"browser": true, "es6": true}, "extends": "eslint:recommended", "rules": {"no-unused-vars": "warn"}}' > .eslintrc.json
        eslint "*.js" || true

  security-scan:
    name: ğŸ”’ Security Scan
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ›¡ï¸ Security Audit
      run: |
        # Check for common security issues
        echo "ğŸ” Scanning for security issues..."
        grep -r "eval(" . --include="*.js" && echo "âš ï¸ Found eval() usage" || echo "âœ… No eval() found"
        grep -r "innerHTML" . --include="*.js" && echo "âš ï¸ Found innerHTML usage" || echo "âœ… No innerHTML found"
        grep -r "document.write" . --include="*.js" && echo "âš ï¸ Found document.write" || echo "âœ… No document.write found"

  performance-check:
    name: âš¡ Performance Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ“Š File Size Check
      run: |
        echo "ğŸ“ Checking file sizes..."
        find . -name "*.js" -exec wc -c {} + | sort -n
        find . -name "*.css" -exec wc -c {} + | sort -n
        find . -name "*.html" -exec wc -c {} + | sort -n
        
        # Check if files are too large
        if [ $(find . -name "*.js" -size +100k | wc -l) -gt 0 ]; then
          echo "âš ï¸ Large JavaScript files found"
        else
          echo "âœ… JavaScript files are optimized"
        fi

  accessibility-check:
    name: â™¿ Accessibility Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ” Accessibility Audit
      run: |
        echo "â™¿ Checking accessibility..."
        # Check for alt attributes
        grep -r "img" . --include="*.html" | grep -v "alt=" && echo "âš ï¸ Images without alt text found" || echo "âœ… All images have alt text"
        # Check for semantic HTML
        grep -r "<div" . --include="*.html" | wc -l > div_count.txt
        grep -r "<section\|<article\|<nav\|<header\|<footer\|<main" . --include="*.html" | wc -l > semantic_count.txt
        echo "ğŸ“Š Semantic HTML usage: $(cat semantic_count.txt) semantic tags vs $(cat div_count.txt) divs"

  pr-validation:
    name: âœ… PR Validation
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ“ PR Title Check
      run: |
        PR_TITLE="${{ github.event.pull_request.title }}"
        if [[ $PR_TITLE =~ ^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+ ]]; then
          echo "âœ… PR title follows conventional commits"
        else
          echo "âŒ PR title should follow format: type(scope): description"
          echo "Examples: feat: add dark mode, fix: resolve upload bug"
          exit 1
        fi
        
    - name: ğŸ“‹ PR Description Check
      run: |
        if [ -z "${{ github.event.pull_request.body }}" ]; then
          echo "âŒ PR description is required"
          exit 1
        else
          echo "âœ… PR has description"
        fi